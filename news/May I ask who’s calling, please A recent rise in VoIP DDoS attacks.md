
> Source : https://blog.cloudflare.com/attacks-on-voip-providers/

## 개요

지난 한 달동안 여러 VoIP(Voice over Internet Protocol) 제공업체가 REvil이라고 주장하는 기업의 디도스 공격 표적이 되었다.  
L7 공격과 결합된 다중벡터 공격은 중요한 HTTP 사이트와 엔드포인트들을 공격했다  
뿐만 아니라 L3/4 공격은 VoIP 서버를 대상으로 공격을 했다 (L7, L3/4 공격 이게 뭘 말하는지 모르겠음)  
몇몇 케이스에서는 이러한 공격이 실제로 특정 VoIP 서비스와 웹사이트의 가용성에 큰 영향을 끼쳤다  

클라우데라는 여러 기술들을 사용하여 음성과 비디오 인프라들을 효과적으로 보호할 수 있는 능력을 가지고 있다고 꺠알 어필  

## VoIP

VoIP는 인터넷을 통해 멀티미디어 데이터를 전송하여 통신하는 기술들의 집합을 의미한다.  
이러한 기술 덕분에 FaceTime을 통해 친구에게 전화를 걸거나 Zoom을 통해 원격 수업을 듣거나 휴대폰을 이용해 전화를 거는 일반적인 행위들이 가능하다  

VoIP의 원리는 회선 교환 네트워크를 통한 기존 디지털 통화와 유사하다.  
가장 큰 차이점은 인코딩 된 미디어 데이터(음성, 영상)이 비트 단위의 작은 단위로 나뉘어져서 미디어 프로토콜을 통해 IP 패킷으로 인터넷에 전달된다는 것이다  


기존의 회선 교환 방식과 음성 데이터의 패킷 교환 방식을 비교해보면, 패킷 교환 방식이 네트워크 리소스를 훨씬 효율적으로 사용하는 방식이다  
때문에, 전화할 때 VoIP를 사용하는 것이 POTS(Plan Old Telephone Service)를 사용하는 것보다 훨씬 가격 대비 효율적이다.  
VoIP로 바꾸는 것만으로 비즈니스에서 사용하는 전화 비용이 절반으로 줄어들 수 있으며 이미 VoIP 기술로 전환한 회사들이 많다는 사실은 놀라운 일이 아니다
VoIP는 탄력적이고 확장가능하며 특히 코로나 시대에 사람들은 원격으로 모이게 만드는데 중요한 기술이다  

VoIP에서 가장 중요한 포로토콜은 SIP(Session Initiation Protocol) 이다.  
SIP는 RFC-2543에 1999년에 정의되었고, 음성이든 영상이든 어떤 세션을 통해 탄력적으로 전달할 수 있도록 디자인되었다  

## Speed is key for VoIP

실제 대화처럼 느끼기 위해서는 자연스럽고 즉각적으로 반응하는 성능이 필요하다  
그러므로 VoIP에서 가장 중요한 요소 중 하나는 속도다  
사용자는 이를 지연이나 끊김 없는 자연스러운 음성 및 고화질 비디오로 경험을 한다  
통화 품질에 대한 사용자에 대한 인식은 일반적으로 Perceptual Evaluation of Speech Quality and Mean Opinition Scores 지표에 의해 측정되고 추적된다  
SIP 와 다른 VoIP 프로토콜은 그 하위에서 TCP 또는 UDP를 사용할 수 있다. 그리고 일반적으로 더 빠른 속도로 제공해주기 위해 UDP 를 사용한다  

UDP는 신뢰할 수 없고 상태 저장이 없고 서비스 퀄리티를 보장할 수 없는 프로토콜이다  
이 말을 다르게 해석하면 라우터와 서버는 UDP 패킷을 처리하기 위해 상대적으로 더 적은 메모리와 연산 비용을 쓴다는 것이다  
패킷을 더 빨리 처리함으로 써 통화 품질이 상승되는 결과로 연결된다  

빠른게 최고다라는 지침하에 VoIP 서버는 FCFS(First Come First Served) 방식으로 가능한 한 빠르게 패킷을 처리하려고 한다  
UDP는 상태 정보를 가지고 있지 않기 때문에 지금 유입 된 패킷이 존재하는 통화 세션에 속해있는 것인지 새로 전화를 거는 세션을 여는 패킷인지 알 수가 없다  

하지만 초당 패킷 비율이 라우터나 서버의 용량 이상으로 증가하면 오히려 단점이 되버린다  
회선 교환 방식에서는 만약 새로운 연결을 받아들일 역량이 되지 않으면 새로운 연결 시도를 거절하고 현재 존재하는 연결을 유지한다  
가능한 많은 패킷을 처리하기 위해 달리는 VoIP서버는 용량 초과 시에도 모든 패킷 또는 호출을 처리할 수 밖에 없다  
그러한 결과는 통화 품질의 저하나 전화 연결에 실패하는 것으로 귀결된다  

따라서 적절한 보호가 이루어지지 않으면 뛰어난 통화 품질을 제공하기 위한 경쟁에서 경쟁자들이 이러한 방법을 사용할 여지가 있으므로 보안 비용이 발생한다 

## DDoSing VoIP servers

공격자들은 UDP와 SIP의 이러한 이점을 활용해서 UDP 패킷을 흘러 넘치도록 전송할 수 있다  
그 중 한가지 방법은 공격자가 전화를 거는 요청인 것처럼 속이는 것이다  
가짜 전화 요청이 피해자에게 갈 때마다 이러한 요청을 처리하기 위해 VoIP 서버는 연산 자원들을 소모하게 된다  
만약 공격자가 충분한 전화 요청을 만들 수가 있다면 피해자에 대한 전화 요청을 처리하는 VoIP 서버는 과부하가 걸리게 될 것이다  
그에 따라 정상적인 전화가 가는 것도 막을 수 있을 것이다.  
이러한 방식이 SIP에 공격하는 기본적인 디도스 방식이다  

![1](https://blog.cloudflare.com/content/images/2021/10/image-3-1.png)

이 기술에 대한 기출 변형 방식은 반사 공격이다.  
이전 기술에서는 무수히 많은 전화 요청 방식을 사용했다. 하지만, 이 기출 변형 방식에는 공격자가 피해자에게 비정상적인 트래픽을 직접적으로 보내지 않는다  
대신에, 공격자는 인터넷 전체에 있는 수천 개의 무작위 SIP 서버로 전송한다.  
오히려 이를 통해서 공격자는 피해자를 디도스 공격에 의해 피해를 받은 희생자인 것처럼 위장을 한다  
이로 인해 수천 개의 SIP 서버는 피해자에게 원치 않는 응답을 보내기 시작한다  
그런 다음 누가 합법적인 전화 요청이였는지 여부를 식별하기 위해 연산 리소스를 사용해야만 한다  
이러한 방법 역시 합법적인 전화 요청을 처리하는데 필요한 피해자의 리소스를 고갈시킬 수 있으며 그 결과, 사용자에게 광범위한 서비스 거부 이벤트가 발생한다  
따라서 적절한 보호 조치가 없다면 VoIP 서비스는 디도스 공격에 매우 취약해진다  

아래 그래프는 실제로 UDP 디도스 공격에 타게팅 되었지만 클라우데라의 보호 서비스를 통해 보호된 VoIP 인프라 서버를 나타낸다.  
이 공격은 초당 70Gbps 및 1,600만 패킷 정도이며 이 정도 규모의 공격은 보호되지 않으면 인프라 장비에 큰 영향을 미칠 수 있다  
이 특정 공격은 10시간 넘게 지속되었고 자동으로 탐지되어 안화되었다 (자사 서비스 꺠알 어필2)  

![2](https://blog.cloudflare.com/content/images/2021/10/1.png)

다음은 지난 주 SIP 인프라에 대해 관찰된 유사한 공격에 대한 두 가지 추가 그래프이다  
첫 번째 차트에서는 여러 프로토콜을 사용하여 DNS 반사 등을 사용한 트래픽 공격을 확인할 수 있다  
이러한 공격은 130Gbps 및 1,740만 pps 이상의 최고점 수치를 나타내었다  

![3](https://blog.cloudflare.com/content/images/2021/10/2.png)

## Protecting VoIP services without sacrificing performance

VoIP 서비스에서 가장 중요한 품질 요소는 당연 스피드이다  
지연 시간이 적을 수록 더더욱 좋다  
그리고 클라우데라의 ~~~ 서비스는 크리티컬한 VoIP 인프라 공격을 보호할 수 있다  

이 밑에는 해당 서비스에 대한 홍보 겸 설명이라 생략